{% extends 'base.html' %}
{% load static %}

{% block title %}{{ province }} å¤©æ°”è¯¦æƒ… - NCDC æ°”è±¡æ•°æ®å¹³å°{% endblock %}

{% block extra_head %}
<style>
    body {
        padding-top: 70px;
        color: #fff !important;
    }
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 20px 0 30px;
        flex-wrap: wrap;
        gap: 15px;
    }
    .page-title {
        color: #00C6FB;
        font-size: 28px;
        text-shadow: 0 0 10px rgba(0, 198, 251, 0.5);
        margin: 0;
    }
    .page-controls {
        display: flex;
        gap: 15px;
        align-items: center;
    }
    .province-select {
        background: rgba(0, 50, 100, 0.8);
        border: 1px solid rgba(0, 198, 251, 0.5);
        color: #00C6FB;
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
    }
    .province-select:focus {
        outline: none;
        border-color: #00C6FB;
    }
    .favorite-btn {
        background: rgba(0, 50, 100, 0.6);
        border: 2px solid #FFD700;
        color: #FFD700;
        padding: 10px 25px;
        border-radius: 30px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .favorite-btn:hover {
        background: rgba(255, 215, 0, 0.2);
        transform: scale(1.05);
    }
    .favorite-btn.favorited {
        background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        color: #000;
    }
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    .stat-card {
        background: linear-gradient(135deg, rgba(0, 198, 251, 0.2) 0%, rgba(119, 68, 255, 0.2) 100%);
        border-radius: 15px;
        padding: 25px;
        text-align: center;
        border: 1px solid rgba(0, 198, 251, 0.3);
        transition: all 0.3s ease;
    }
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 198, 251, 0.2);
    }
    .stat-icon {
        font-size: 40px;
        margin-bottom: 10px;
    }
    .stat-value {
        font-size: 32px;
        font-weight: bold;
        color: #00C6FB;
        margin-bottom: 5px;
    }
    .stat-label {
        font-size: 14px;
        color: #fff !important;
    }
    .stat-sub {
        font-size: 12px;
        color: #fff !important;
        margin-top: 5px;
    }
    .chart-container {
        background: rgba(0, 30, 60, 0.8);
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        border: 1px solid rgba(0, 198, 251, 0.3);
    }
    .chart-box {
        height: 350px;
    }
    .chart-box-large {
        height: 450px;
    }
    .section-title {
        color: #00C6FB !important;
        font-size: 20px;
        margin-bottom: 20px;
        padding-left: 15px;
        border-left: 4px solid #00C6FB;
    }
    /* è¯¦ç»†æ°”è±¡ä¿¡æ¯ - ä¸‰åˆ—æ¨ªå‘å¸ƒå±€ */
    .weather-info-grid {
        display: grid !important;
        grid-template-columns: repeat(3, 1fr) !important;
        gap: 20px !important;
        margin-bottom: 30px !important;
    }
    @media (max-width: 992px) {
        .weather-info-grid {
            grid-template-columns: repeat(2, 1fr) !important;
        }
    }
    @media (max-width: 576px) {
        .weather-info-grid {
            grid-template-columns: 1fr !important;
        }
    }
    .weather-card {
        background: linear-gradient(135deg, rgba(0, 40, 80, 0.9) 0%, rgba(0, 20, 50, 0.95) 100%) !important;
        border-radius: 18px !important;
        padding: 25px !important;
        border: 1px solid rgba(0, 198, 251, 0.3) !important;
        transition: all 0.3s ease !important;
    }
    .weather-card:hover {
        transform: translateY(-5px) !important;
        border-color: #00C6FB !important;
        box-shadow: 0 10px 30px rgba(0, 198, 251, 0.2) !important;
    }
    .weather-card h4 {
        color: #00C6FB !important;
        margin-bottom: 20px !important;
        font-size: 20px !important;
        display: flex !important;
        align-items: center !important;
        gap: 8px !important;
        padding-bottom: 12px !important;
        border-bottom: 2px solid rgba(0, 198, 251, 0.3) !important;
    }
    .weather-item {
        display: flex !important;
        flex-direction: row !important;
        justify-content: space-between !important;
        align-items: center !important;
        padding: 14px 0 !important;
        border-bottom: 1px solid rgba(0, 198, 251, 0.1) !important;
    }
    .weather-item:last-child {
        border-bottom: none !important;
        padding-bottom: 0 !important;
    }
    .weather-item-label {
        color: rgba(255, 255, 255, 0.8) !important;
        font-size: 14px !important;
        letter-spacing: 0.3px !important;
    }
    .weather-item-value {
        color: #00C6FB !important;
        font-weight: 700 !important;
        font-size: 16px !important;
        text-align: right !important;
    }
    /* æœªæ¥7å¤©å¤©æ°”é¢„æŠ¥ - å¡ç‰‡æ¨ªå‘æ’åˆ— */
    .forecast-strip {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: wrap !important;
        gap: 15px !important;
        justify-content: flex-start !important;
    }
    .forecast-item {
        flex: 0 0 auto !important;
        width: 130px !important;
        min-width: 130px !important;
        max-width: 130px !important;
        background: linear-gradient(135deg, rgba(0, 50, 100, 0.8) 0%, rgba(0, 30, 60, 0.9) 100%) !important;
        border-radius: 16px !important;
        padding: 20px 15px !important;
        border: 1px solid rgba(0, 198, 251, 0.3) !important;
        transition: all 0.3s ease !important;
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        text-align: center !important;
        gap: 12px !important;
    }
    .forecast-item:hover {
        transform: translateY(-6px) !important;
        border-color: #00C6FB !important;
        box-shadow: 0 10px 25px rgba(0, 198, 251, 0.3) !important;
        background: linear-gradient(135deg, rgba(0, 70, 120, 0.9) 0%, rgba(0, 40, 80, 0.95) 100%) !important;
    }
    .forecast-day {
        color: #fff !important;
        font-size: 16px !important;
        font-weight: 700 !important;
        letter-spacing: 0.5px !important;
    }
    .forecast-icon {
        font-size: 42px !important;
        line-height: 1 !important;
    }
    .forecast-details {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        gap: 8px !important;
        width: 100% !important;
    }
    .forecast-detail {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        gap: 3px !important;
        width: 100% !important;
    }
    .forecast-detail-label {
        font-size: 11px !important;
        color: rgba(255, 255, 255, 0.6) !important;
        letter-spacing: 0.5px !important;
    }
    .forecast-detail-value {
        font-size: 14px !important;
        color: #00C6FB !important;
        font-weight: 600 !important;
    }
    .back-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: rgba(0, 50, 100, 0.6);
        border: 1px solid rgba(0, 198, 251, 0.5);
        color: #00C6FB !important;
        padding: 10px 20px;
        border-radius: 8px;
        text-decoration: none;
        transition: all 0.3s ease;
        margin-bottom: 20px;
    }
    .back-btn:hover {
        background: rgba(0, 198, 251, 0.2);
        color: #fff !important;
        text-decoration: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <a href="{% url 'province_list' %}" class="back-btn">â† è¿”å›çœä»½åˆ—è¡¨</a>
    
    <div class="page-header">
        <h1 class="page-title">ğŸ“ {{ province }} å¤©æ°”è¯¦æƒ…</h1>
        <div class="page-controls">
            <select class="province-select" id="provinceSelect" onchange="changeProvince()">
            </select>
            <button class="favorite-btn {% if is_favorite %}favorited{% endif %}" id="favoriteBtn" onclick="toggleFavorite()">
                <span id="favoriteIcon">{% if is_favorite %}â˜…{% else %}â˜†{% endif %}</span>
                <span id="favoriteText">{% if is_favorite %}å·²æ”¶è—{% else %}æ”¶è—{% endif %}</span>
            </button>
        </div>
    </div>
    
    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">ğŸŒ¡ï¸</div>
            <div class="stat-value">{{ stats.avg_temp }}Â°C</div>
            <div class="stat-label">å¹´å‡æ¸©åº¦</div>
            <div class="stat-sub">å…¨å›½æ’å ç¬¬{{ stats.temp_rank }}ä½</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">ğŸ”¥</div>
            <div class="stat-value">{{ stats.max_temp }}Â°C</div>
            <div class="stat-label">å¹´åº¦æœ€é«˜æ¸©</div>
            <div class="stat-sub">{{ stats.max_temp_month }}æœˆ</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">â„ï¸</div>
            <div class="stat-value">{{ stats.min_temp }}Â°C</div>
            <div class="stat-label">å¹´åº¦æœ€ä½æ¸©</div>
            <div class="stat-sub">{{ stats.min_temp_month }}æœˆ</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">ğŸŒ§ï¸</div>
            <div class="stat-value">{{ stats.avg_rain }}mm</div>
            <div class="stat-label">æœˆå‡é™æ°´é‡</div>
            <div class="stat-sub">å…¨å¹´ç´¯è®¡ {{ stats.total_rain }}mm</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">ğŸ’¨</div>
            <div class="stat-value">{{ stats.avg_wind }}m/s</div>
            <div class="stat-label">å¹´å‡é£é€Ÿ</div>
            <div class="stat-sub">ä¸»å¯¼é£å‘: {{ stats.main_wind_dir }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">ğŸ“Š</div>
            <div class="stat-value">{{ stats.avg_pressure }}hPa</div>
            <div class="stat-label">å¹´å‡æ°”å‹</div>
            <div class="stat-sub">æ°”å‹ç¨³å®šåº¦: {{ stats.pressure_stability }}</div>
        </div>
    </div>
    
    <!-- å›¾è¡¨åŒºåŸŸ -->
    <h2 class="section-title">æ°”è±¡å›¾è¡¨åˆ†æ</h2>
    
    <div class="row">
        <div class="col-md-8">
            <div class="chart-container">
                <div class="chart-box-large" id="monthlyTempChart"></div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="chart-container">
                <div class="chart-box-large" id="windRoseChart"></div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-6">
            <div class="chart-container">
                <div class="chart-box" id="historyTrendChart"></div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="chart-container">
                <div class="chart-box" id="yoyCompareChart"></div>
            </div>
        </div>
    </div>
    
    <!-- æœªæ¥å¤©æ°”é¢„æŠ¥ -->
    <h2 class="section-title">æ¨¡æ‹Ÿæœªæ¥7å¤©å¤©æ°”é¢„æŠ¥</h2>
    <div class="chart-container">
        <div class="forecast-strip">
            {% for day in forecast %}
            <div class="forecast-item">
                <div class="forecast-day">{{ day.date }}</div>
                <div class="forecast-icon">{{ day.icon }}</div>
                <div class="forecast-details">
                    <div class="forecast-detail">
                        <span class="forecast-detail-label">å¹³å‡æ¸©åº¦</span>
                        <span class="forecast-detail-value">{{ day.temp }}Â°C</span>
                    </div>
                    <div class="forecast-detail">
                        <span class="forecast-detail-label">æ¸©åº¦èŒƒå›´</span>
                        <span class="forecast-detail-value">{{ day.low }}Â° ~ {{ day.high }}Â°</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <!-- è¯¦ç»†æ°”è±¡ä¿¡æ¯ -->
    <h2 class="section-title">è¯¦ç»†æ°”è±¡ä¿¡æ¯</h2>
    <div class="weather-info-grid">
        <div class="weather-card">
            <h4>ğŸŒ¡ï¸ æ¸©åº¦ç»Ÿè®¡</h4>
            <div class="weather-item">
                <span class="weather-item-label">å¹´å¹³å‡æ¸©åº¦</span>
                <span class="weather-item-value">{{ stats.avg_temp }}Â°C</span>
            </div>
            <div class="weather-item">
                <span class="weather-item-label">æœ€çƒ­æœˆä»½</span>
                <span class="weather-item-value">{{ stats.max_temp_month }}æœˆ ({{ stats.max_temp }}Â°C)</span>
            </div>
            <div class="weather-item">
                <span class="weather-item-label">æœ€å†·æœˆä»½</span>
                <span class="weather-item-value">{{ stats.min_temp_month }}æœˆ ({{ stats.min_temp }}Â°C)</span>
            </div>
            <div class="weather-item">
                <span class="weather-item-label">æ¸©å·®</span>
                <span class="weather-item-value">{{ stats.temp_range }}Â°C</span>
            </div>
        </div>
        <div class="weather-card">
            <h4>ğŸŒ§ï¸ é™æ°´ç»Ÿè®¡</h4>
            <div class="weather-item">
                <span class="weather-item-label">æœˆå‡é™æ°´é‡</span>
                <span class="weather-item-value">{{ stats.avg_rain }}mm</span>
            </div>
            <div class="weather-item">
                <span class="weather-item-label">å¹´æ€»é™æ°´é‡</span>
                <span class="weather-item-value">{{ stats.total_rain }}mm</span>
            </div>
            <div class="weather-item">
                <span class="weather-item-label">é™æ°´æœ€å¤šæœˆä»½</span>
                <span class="weather-item-value">{{ stats.max_rain_month }}æœˆ</span>
            </div>
            <div class="weather-item">
                <span class="weather-item-label">é™æ°´ç±»å‹</span>
                <span class="weather-item-value">{{ stats.rain_type }}</span>
            </div>
        </div>
        <div class="weather-card">
            <h4>ğŸ’¨ é£åŠ›ç»Ÿè®¡</h4>
            <div class="weather-item">
                <span class="weather-item-label">å¹´å‡é£é€Ÿ</span>
                <span class="weather-item-value">{{ stats.avg_wind }}m/s</span>
            </div>
            <div class="weather-item">
                <span class="weather-item-label">ä¸»å¯¼é£å‘</span>
                <span class="weather-item-value">{{ stats.main_wind_dir }}</span>
            </div>
            <div class="weather-item">
                <span class="weather-item-label">æœ€å¤§é£é€Ÿ</span>
                <span class="weather-item-value">{{ stats.max_wind }}m/s</span>
            </div>
            <div class="weather-item">
                <span class="weather-item-label">é£åŠ›ç­‰çº§</span>
                <span class="weather-item-value">{{ stats.wind_level }}</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    var province = '{{ province }}';
    var provinces = JSON.parse('{{ provinces|escapejs }}');
    var monthlyData = JSON.parse('{{ monthly_data|escapejs }}');
    var historyData = JSON.parse('{{ history_data|escapejs }}');
    var windData = JSON.parse('{{ wind_data|escapejs }}');
    
    // åˆå§‹åŒ–çœä»½ä¸‹æ‹‰æ¡†
    function initProvinceSelect() {
        var select = document.getElementById('provinceSelect');
        provinces.forEach(function(p) {
            var option = document.createElement('option');
            option.value = p;
            option.textContent = p;
            if (p === province) {
                option.selected = true;
            }
            select.appendChild(option);
        });
    }
    
    // åˆ‡æ¢çœä»½
    function changeProvince() {
        var selected = document.getElementById('provinceSelect').value;
        window.location.href = '/province/' + encodeURIComponent(selected) + '/';
    }
    
    // æ”¶è—åŠŸèƒ½
    function toggleFavorite() {
        var btn = document.getElementById('favoriteBtn');
        var icon = document.getElementById('favoriteIcon');
        var text = document.getElementById('favoriteText');
        
        fetch('/api/toggle_favorite/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({ province: province })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                if (data.is_favorite) {
                    btn.classList.add('favorited');
                    icon.textContent = 'â˜…';
                    text.textContent = 'å·²æ”¶è—';
                } else {
                    btn.classList.remove('favorited');
                    icon.textContent = 'â˜†';
                    text.textContent = 'æ”¶è—';
                }
            } else if (data.redirect) {
                window.location.href = data.redirect;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•');
        });
    }
    
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    
    // 1. æœˆåº¦æ¸©åº¦è¶‹åŠ¿å›¾
    function renderMonthlyTempChart() {
        var chart = echarts.init(document.getElementById('monthlyTempChart'));
        
        var months = monthlyData.months || ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
        var avgTemps = monthlyData.avg_temps || [];
        var maxTemps = monthlyData.max_temps || [];
        var minTemps = monthlyData.min_temps || [];
        
        var option = {
            title: {
                text: province + ' æœˆåº¦æ¸©åº¦å˜åŒ–',
                textStyle: { color: '#00C6FB', fontSize: 16 },
                left: 'center'
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: { type: 'cross' }
            },
            legend: {
                data: ['å¹³å‡æ¸©åº¦', 'æœ€é«˜æ¸©åº¦', 'æœ€ä½æ¸©åº¦'],
                bottom: 0,
                textStyle: { color: '#fff' }
            },
            grid: { left: '3%', right: '4%', bottom: '15%', containLabel: true },
            xAxis: {
                type: 'category',
                data: months,
                axisLabel: { color: '#fff' },
                axisLine: { lineStyle: { color: '#00C6FB' } }
            },
            yAxis: {
                type: 'value',
                name: 'æ¸©åº¦(Â°C)',
                nameTextStyle: { color: '#fff' },
                axisLabel: { color: '#fff' },
                splitLine: { lineStyle: { color: 'rgba(0,198,251,0.2)' } }
            },
            series: [
                {
                    name: 'å¹³å‡æ¸©åº¦',
                    type: 'line',
                    data: avgTemps,
                    smooth: true,
                    lineStyle: { color: '#00C6FB', width: 3 },
                    itemStyle: { color: '#00C6FB' },
                    areaStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: 'rgba(0, 198, 251, 0.3)' },
                            { offset: 1, color: 'rgba(0, 198, 251, 0.05)' }
                        ])
                    }
                },
                {
                    name: 'æœ€é«˜æ¸©åº¦',
                    type: 'line',
                    data: maxTemps,
                    smooth: true,
                    lineStyle: { color: '#FF6B6B', width: 2, type: 'dashed' },
                    itemStyle: { color: '#FF6B6B' }
                },
                {
                    name: 'æœ€ä½æ¸©åº¦',
                    type: 'line',
                    data: minTemps,
                    smooth: true,
                    lineStyle: { color: '#6BC5FF', width: 2, type: 'dashed' },
                    itemStyle: { color: '#6BC5FF' }
                }
            ]
        };
        chart.setOption(option);
        window.addEventListener('resize', () => chart.resize());
    }
    
    // 2. é£å‘ç«ç‘°å›¾
    function renderWindRoseChart() {
        var chart = echarts.init(document.getElementById('windRoseChart'));
        
        var directions = ['åŒ—', 'ä¸œåŒ—', 'ä¸œ', 'ä¸œå—', 'å—', 'è¥¿å—', 'è¥¿', 'è¥¿åŒ—'];
        var values = windData.values || [0, 0, 0, 0, 0, 0, 0, 0];
        
        var option = {
            title: {
                text: 'é£å‘åˆ†å¸ƒ',
                textStyle: { color: '#00C6FB', fontSize: 16 },
                left: 'center'
            },
            tooltip: {},
            radar: {
                indicator: directions.map(d => ({ name: d, max: Math.max(...values) * 1.2 || 100 })),
                center: ['50%', '55%'],
                radius: '65%',
                axisName: { color: '#fff', fontSize: 12 },
                splitLine: { lineStyle: { color: 'rgba(0,198,251,0.3)' } },
                splitArea: { areaStyle: { color: ['rgba(0, 198, 251, 0.1)', 'rgba(0, 198, 251, 0.05)'] } }
            },
            series: [{
                type: 'radar',
                data: [{
                    value: values,
                    name: 'é£å‘é¢‘ç‡',
                    areaStyle: { color: 'rgba(0, 198, 251, 0.5)' },
                    lineStyle: { color: '#00C6FB', width: 2 },
                    itemStyle: { color: '#00C6FB' }
                }]
            }]
        };
        chart.setOption(option);
        window.addEventListener('resize', () => chart.resize());
    }
    
    // 3. å†å²è¶‹åŠ¿å›¾
    function renderHistoryTrendChart() {
        var chart = echarts.init(document.getElementById('historyTrendChart'));
        
        var years = historyData.years || [];
        var temps = historyData.temps || [];
        
        var option = {
            title: {
                text: 'å†å²å¹´å‡æ¸©åº¦è¶‹åŠ¿',
                textStyle: { color: '#00C6FB', fontSize: 16 },
                left: 'center'
            },
            tooltip: {
                trigger: 'axis',
                formatter: '{b}å¹´: {c}Â°C'
            },
            xAxis: {
                type: 'category',
                data: years,
                axisLabel: { color: '#fff', rotate: 45 },
                axisLine: { lineStyle: { color: '#00C6FB' } }
            },
            yAxis: {
                type: 'value',
                name: 'æ¸©åº¦(Â°C)',
                nameTextStyle: { color: '#fff' },
                axisLabel: { color: '#fff' },
                splitLine: { lineStyle: { color: 'rgba(0,198,251,0.2)' } }
            },
            series: [{
                type: 'line',
                data: temps,
                smooth: true,
                lineStyle: { color: '#FFD93D', width: 2 },
                itemStyle: { color: '#FFD93D' },
                markLine: {
                    data: [{ type: 'average', name: 'å¹³å‡' }],
                    lineStyle: { color: '#FF6B6B' },
                    label: { color: '#FF6B6B' }
                }
            }]
        };
        chart.setOption(option);
        window.addEventListener('resize', () => chart.resize());
    }
    
    // 4. å¹´åŒæ¯”å›¾
    function renderYoyCompareChart() {
        var chart = echarts.init(document.getElementById('yoyCompareChart'));
        
        var years = historyData.years || [];
        var temps = historyData.temps || [];
        
        var changes = [];
        for (var i = 1; i < temps.length; i++) {
            changes.push(Math.round((temps[i] - temps[i-1]) * 10) / 10);
        }
        
        var option = {
            title: {
                text: 'å¹´å‡æ¸©åº¦åŒæ¯”å˜åŒ–',
                textStyle: { color: '#00C6FB', fontSize: 16 },
                left: 'center'
            },
            tooltip: {
                trigger: 'axis',
                formatter: function(params) {
                    var val = params[0].value;
                    return params[0].name + 'å¹´: ' + (val > 0 ? '+' : '') + val + 'Â°C';
                }
            },
            xAxis: {
                type: 'category',
                data: years.slice(1),
                axisLabel: { color: '#fff', rotate: 45 },
                axisLine: { lineStyle: { color: '#00C6FB' } }
            },
            yAxis: {
                type: 'value',
                name: 'å˜åŒ–(Â°C)',
                nameTextStyle: { color: '#fff' },
                axisLabel: { color: '#fff' },
                splitLine: { lineStyle: { color: 'rgba(0,198,251,0.2)' } }
            },
            series: [{
                type: 'bar',
                data: changes,
                itemStyle: {
                    color: function(params) {
                        return params.value >= 0 ? '#FF6B6B' : '#6BC5FF';
                    }
                },
                label: {
                    show: true,
                    position: function(params) {
                        return params.value >= 0 ? 'top' : 'bottom';
                    },
                    color: '#fff',
                    fontSize: 10,
                    formatter: function(params) {
                        return (params.value > 0 ? '+' : '') + params.value;
                    }
                }
            }]
        };
        chart.setOption(option);
        window.addEventListener('resize', () => chart.resize());
    }
    
    // åˆå§‹åŒ–æ‰€æœ‰å›¾è¡¨
    document.addEventListener('DOMContentLoaded', function() {
        initProvinceSelect();
        renderMonthlyTempChart();
        renderWindRoseChart();
        renderHistoryTrendChart();
        renderYoyCompareChart();
    });
</script>
{% endblock %}
