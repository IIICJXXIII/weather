{% extends 'base.html' %}
{% load static %}

{% block title %}å†å²æ•°æ®æŸ¥è¯¢ - NCDC æ°”è±¡æ•°æ®å¹³å°{% endblock %}

{% block extra_head %}
<style>
    /* é¡µé¢å±…ä¸­å¸ƒå±€ */
    .history-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 0 20px;
    }
    .history-row {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
    }
    .history-content {
        width: 100%;
        max-width: 800px;
    }
    .form-label {
        color: #00C6FB;
        font-size: 14px;
        margin-bottom: 8px;
        display: block;
    }
    .query-form {
        padding: 10px 0;
    }
    .query-form .row {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
    }
    .query-form .col-md-4 {
        flex: 1;
        min-width: 200px;
    }
    .quick-links {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
    }
    .quick-links a {
        text-decoration: none;
        transition: all 0.3s ease;
    }
    .quick-links a:hover {
        transform: translateY(-2px);
        background: rgba(0, 198, 251, 0.3);
    }
    .result-stats {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
    }
    .result-stats .stat-card {
        flex: 1;
        min-width: 180px;
        max-width: 250px;
    }
</style>
{% endblock %}

{% block content %}
<div class="history-container">
    <div class="page-header">
        <h1 class="page-title">ğŸ“… å†å²æ•°æ®æŸ¥è¯¢</h1>
        <p class="page-subtitle">æŸ¥è¯¢æŒ‡å®šçœä»½å’Œæœˆä»½çš„æ°”è±¡æ•°æ®</p>
    </div>

    <!-- æŸ¥è¯¢è¡¨å• -->
    <div class="history-row">
        <div class="history-content">
            <div class="panel">
                <form method="get" class="query-form">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">é€‰æ‹©çœä»½</label>
                            <select name="province" class="form-control-custom w-100" required>
                                <option value="">-- è¯·é€‰æ‹©çœä»½ --</option>
                                {% for p in provinces %}
                                <option value="{{ p }}" {% if p == selected_province %}selected{% endif %}>{{ p }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">é€‰æ‹©æœˆä»½</label>
                            <select name="month" class="form-control-custom w-100" required>
                                <option value="">-- è¯·é€‰æ‹©æœˆä»½ --</option>
                                {% for m in months %}
                                <option value="{{ m }}" {% if m|stringformat:"s" == selected_month %}selected{% endif %}>{{ m }}æœˆ</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4 mb-3 d-flex align-items-end">
                            <button type="submit" class="btn-primary-custom w-100">
                                ğŸ” æŸ¥è¯¢æ•°æ®
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- æŸ¥è¯¢ç»“æœ -->
    {% if result_data %}
    <div class="history-row">
        <div class="history-content">
            <div class="panel">
                <h3 class="panel-title">ğŸ“Š {{ result_data.province }} - {{ result_data.month }}æœˆ æ°”è±¡æ•°æ®</h3>
                
                <div class="result-stats">
                    <div class="stat-card">
                        <div class="stat-value">
                            {% if result_data.temp is not None %}
                            {{ result_data.temp }}Â°C
                            {% else %}
                            --
                            {% endif %}
                        </div>
                        <div class="stat-label">ğŸŒ¡ï¸ å¹³å‡æ¸©åº¦</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">
                            {% if result_data.wind is not None %}
                            {{ result_data.wind }} m/s
                            {% else %}
                            --
                            {% endif %}
                        </div>
                        <div class="stat-label">ğŸ’¨ å¹³å‡é£é€Ÿ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">
                            {% if result_data.pressure is not None %}
                            {{ result_data.pressure }}
                            {% else %}
                            --
                            {% endif %}
                        </div>
                        <div class="stat-label">ğŸ”½ å¹³å‡æ°”å‹ (hPa)</div>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <a href="{% url 'province_detail' result_data.province %}" class="btn-secondary-custom">
                        æŸ¥çœ‹{{ result_data.province }}è¯¦æƒ… â†’
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% elif selected_province or selected_month %}
    <div class="history-row">
        <div class="history-content">
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ˜•</div>
                <div class="empty-state-text">æœªæ‰¾åˆ°ç›¸å…³æ•°æ®ï¼Œè¯·æ£€æŸ¥æŸ¥è¯¢æ¡ä»¶</div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="history-row">
        <div class="history-content">
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ‘†</div>
                <div class="empty-state-text">è¯·é€‰æ‹©çœä»½å’Œæœˆä»½è¿›è¡ŒæŸ¥è¯¢</div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- å¿«æ·æŸ¥è¯¢ -->
    <div class="history-row" style="margin-top: 30px;">
        <div class="history-content">
            <div class="panel">
                <h3 class="panel-title">âš¡ å¿«æ·æŸ¥è¯¢</h3>
                <div class="quick-links">
                    {% for p in provinces|slice:":12" %}
                    <a href="?province={{ p }}&month=7" class="tag tag-primary">{{ p }} Â· 7æœˆ</a>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
